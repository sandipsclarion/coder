{
    "$schema":"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
    "contentVersion":"1.0.0.0",
    "parameters":{
        "siteName":{
            "type":"string",
            "defaultValue":"clariondemoapp6",
            "metadata":{
                "description":"Demo Web App."
            }
        },
        "hostingPlanName":{
            "type":"string",
            "defaultValue":"ServicePlan",
            "metadata":{
                "description":"The name of the App Service plan to use for hosting the web app."
            }
        },
        "siteLocation":{
            "type":"string",
            "defaultValue":"South Central US",
            "metadata":{
                "description":"South Central US"
            }
        },
        "sku":{
            "type":"string",
            "defaultValue":"Standard",
            "metadata":{
                "description":"The pricing tier for the hosting plan."
            }
        },
        "workerSize":{
            "type":"string",
            "defaultValue":"1",
            "metadata":{
                "description":"The instance size of the hosting plan (small)."
            }
        },
        "repoURL":{
            "type":"string",
            "defaultValue":"https://github.com/sandipsclarion/coder.git",
            "metadata":{
                "description":"The URL for the GitHub repository that contains the project to deploy."
            }
        },
        "branch":{
            "type":"string",
            "defaultValue":"master",
            "metadata":{
                "description":"Master branch of the GitHub repository to use."
            }
        },
		"databaseServerName":{
            "type":"string",
			"defaultValue":"us-cdbr-azure-southcentral-e.cloudapp.net"
        },
        "databaseName":{
            "type":"string",
			"defaultValue":"clariondemoapp6_db"
        },
        "databaseUsername":{
            "type":"string",
			"defaultValue":"clariondemoapp6_usr",
        },
        "databasePassword":{
            "type":"string",
			"defaultValue":"clariondemoapp6_pwd",
        }
    },
	"variables":{
        "dbConnectionString":"[concat('Database=', parameters('databaseName'), ';Data Source=', parameters('databaseServerName'), ';User Id=', parameters('databaseUsername'), ';Password=', parameters('databasePassword'))]"
    },
    "resources":[
        {
            "apiVersion":"2015-08-01",
            "type":"Microsoft.Web/serverfarms",
            "name":"[parameters('hostingPlanName')]",
            "location":"[resourceGroup().location]",
            "sku":{
                "tier":"Standard",
                "name":"f1",
                "capacity":0
            },
            "properties":{
                "numberOfWorkers":1
            }
        },
        {
            "apiVersion":"2015-08-01",
            "name":"[parameters('siteName')]",
            "type":"Microsoft.Web/sites",
            "location":"[parameters('siteLocation')]",
            "dependsOn":[
                "[resourceId('Microsoft.Web/serverfarms', parameters('hostingPlanName'))]"
            ],
            "properties":{
                "serverFarmId":"[parameters('hostingPlanName')]"
            },
            "resources":[
                {
                    "apiVersion":"2015-08-01",
                    "name":"web",
                    "type":"sourcecontrols",
                    "dependsOn":[
                        "[resourceId('Microsoft.Web/Sites', parameters('siteName'))]"
                    ],
                    "properties":{
                        "RepoUrl":"[parameters('repoURL')]",
                        "branch":"[parameters('branch')]",
                        "IsManualIntegration":true
                    }
                },
                {
                    "apiVersion":"2014-11-01",
                    "name":"connectionstrings",
                    "type":"config",
                    "dependsOn":[
                        "[concat('Microsoft.Web/sites/', parameters('siteName'))]"
                    ],
                    "properties":{
                        "defaultConnection":{
                            "value":"[variables('dbConnectionString')]",
                            "type":0
                        }
                    }
                },
                {
                    "apiVersion":"2014-06-01",
                    "name":"web",
                    "type":"config",
                    "dependsOn":[
                        "[concat('Microsoft.Web/sites/', parameters('siteName'))]"
                    ],
                    "properties":{
                        "phpVersion":"5.6"
                    }
                },
                {
                    "name":"MSDeploy",
                    "type":"extensions",
                    "location":"[resourceGroup().location]",
                    "apiVersion":"2014-06-01",
                    "dependsOn":[
                        "[concat('Microsoft.Web/sites/', parameters('siteName'))]",
                        "[concat('Microsoft.Web/Sites/', parameters('siteName'), '/config/web')]"
                    ],
                    "tags":{
                        "displayName":"WordPressDeploy"
                    },
                    "properties":{
                        "packageUri":"https://auxmktplceprod.blob.core.windows.net/packages/wordpress-4.3.1-IIS.zip",
                        "dbType":"MySQL",
                        "connectionString":"[variables('dbConnectionString')]",
                        "setParameters":{
                            "AppPath":"[parameters('siteName')]",
                            "DbServer":"[parameters('databaseServerName')]",
                            "DbName":"[parameters('databaseName')]",
                            "DbUsername":"[parameters('databaseUsername')]",
                            "DbPassword":"[parameters('databasePassword')]",
                            "DbAdminUsername":"[parameters('databaseUsername')]",
                            "DbAdminPassword":"[parameters('databasePassword')]"
                        }
                    }
                }
            ]
        }
    ]
}